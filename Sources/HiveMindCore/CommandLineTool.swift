//
//  CommandLineTool.swift
//  HiveMindCore
//
//  Created by Joseph Roque on 2019-02-12.
//  Copyright Â© 2019 Joseph Roque. All rights reserved.
//

import Foundation
import HiveEngine

public final class CommandLineTool {
	private let arguments: [String]

	public init(arguments: [String] = CommandLine.arguments) {
		self.arguments = Array(arguments.dropFirst())
	}

	public func run() throws {
		guard arguments.count > 0 else {
			print("No arguments provided.")
			return
		}

		if arguments.count == 1 {
			parseArgument(arguments[0])
		} else if arguments.count == 2 {
			parseArgument(arguments[0], withValue: arguments[1])
		} else {
			print("Invalid arguments.")
		}
	}

	private func parseArgument(_ argument: String) {
		switch argument {
		case "-h", "--help":
			print("""
			Welcome to the HiveMind. Usage:
				--new
					Print a new state.
				--play <state>
					Print a valid play for the given state.
			""")
		case "--new":
			let hivemind = HiveMind()
			print(hivemind.state.json())
		default:
			print("Invalid arguments.")
		}
	}

	private func parseArgument(_ argument: String, withValue value: String) {
		switch argument {
		case "--play":
			if let hivemind = try? HiveMind(fromJSON: "{\"units\":[{\"class\":\"Ant\", \"owner\":\"White\", \"identifier\":\"4D66AFC3-ADAE-4266-86E8-8E02C61D1169\"}, {\"inHand\":true}, {\"class\":\"Pill Bug\", \"owner\":\"Black\", \"identifier\":\"10341696-AA07-4EDB-B483-E5E78CD24488\"}, {\"inHand\":true}, {\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"F4457CE0-BB72-445D-8CC5-019E2FC4067D\"}, {\"inHand\":true}, {\"class\":\"Beetle\", \"owner\":\"Black\", \"identifier\":\"5D03EEFC-1173-4925-B7F7-B3A703C02A75\"}, {\"inHand\":true}, {\"class\":\"Hopper\", \"owner\":\"Black\", \"identifier\":\"CE761315-21A7-4912-BBDC-A542647888BE\"}, {\"inHand\":true}, {\"class\":\"Beetle\", \"owner\":\"Black\", \"identifier\":\"1C2FEADF-7875-4C33-8023-CAE04F94DA70\"}, {\"inHand\":true}, {\"class\":\"Spider\", \"owner\":\"Black\", \"identifier\":\"4567454F-B069-4EF1-AA62-268D46EDC706\"}, {\"inPlay\":{\"x\":0, \"y\":1, \"z\":-1}}, {\"class\":\"Mosquito\", \"owner\":\"Black\", \"identifier\":\"93DBF6D9-3C53-4A4C-9208-CF4A8102A34D\"}, {\"inHand\":true}, {\"class\":\"Hopper\", \"owner\":\"White\", \"identifier\":\"F97C07AF-633A-4B1E-A69B-C2B69867E0D5\"}, {\"inHand\":true}, {\"class\":\"Lady Bug\", \"owner\":\"Black\", \"identifier\":\"FDDDF012-9CD0-4D03-93E6-EF0FC37D1E76\"}, {\"inHand\":true}, {\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"13C4FD01-FD2B-4A4C-851F-9925EF7B469D\"}, {\"inPlay\":{\"x\":-1, \"y\":-1, \"z\":2}}, {\"class\":\"Spider\", \"owner\":\"Black\", \"identifier\":\"FC0FAA17-0D4D-4499-84F2-C7A4EFB8F012\"}, {\"inHand\":true}, {\"class\":\"Ant\", \"owner\":\"White\", \"identifier\":\"D8C45BE7-6518-4A6A-A7D2-39C316DF05FF\"}, {\"inHand\":true}, {\"class\":\"Lady Bug\", \"owner\":\"White\", \"identifier\":\"23707BC7-AA72-497E-B8B5-62BAB982F35C\"}, {\"inHand\":true}, {\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"8D710D17-570A-4AB8-A65F-4179A431C05A\"}, {\"inHand\":true}, {\"class\":\"Hopper\", \"owner\":\"Black\", \"identifier\":\"24958CFC-F0C9-4AEE-AF76-4F0D190D3738\"}, {\"inHand\":true}, {\"class\":\"Hopper\", \"owner\":\"Black\", \"identifier\":\"3962DCC3-431A-4BDF-8193-8AD7285C4E82\"}, {\"inHand\":true}, {\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"B969BE7A-9D22-4491-8E46-F09633D9E087\"}, {\"inPlay\":{\"x\":1, \"y\":-2, \"z\":1}}, {\"class\":\"Ant\", \"owner\":\"White\", \"identifier\":\"068429AB-BAB9-42C9-9ADC-A6195A72E356\"}, {\"inPlay\":{\"x\":0, \"y\":0, \"z\":0}}, {\"class\":\"Spider\", \"owner\":\"White\", \"identifier\":\"1AA3D8E9-70CA-487F-A18F-0D22F801CECA\"}, {\"inHand\":true}, {\"class\":\"Hopper\", \"owner\":\"White\", \"identifier\":\"3C82A1A8-1BA7-4C49-BBBB-3DA5B1B15945\"}, {\"inHand\":true}, {\"class\":\"Mosquito\", \"owner\":\"White\", \"identifier\":\"5D125385-4CF1-420D-B6BC-2DF60E7A1BAA\"}, {\"inHand\":true}, {\"class\":\"Pill Bug\", \"owner\":\"White\", \"identifier\":\"439C1ED9-736C-43C0-8F0B-8EDF1BB1B4B1\"}, {\"inHand\":true}, {\"class\":\"Spider\", \"owner\":\"White\", \"identifier\":\"87F0700D-E181-4D38-8C31-461BA3B12D1C\"}, {\"inHand\":true}, {\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"2BE8249A-8D89-4FBA-8FDC-E7F3FF72EAAE\"}, {\"inPlay\":{\"x\":-1, \"y\":0, \"z\":1}}, {\"class\":\"Queen\", \"owner\":\"Black\", \"identifier\":\"12B6024E-6937-47A1-99F7-6A69A8D9F3C4\"}, {\"inPlay\":{\"x\":0, \"y\":2, \"z\":-2}}, {\"class\":\"Queen\", \"owner\":\"White\", \"identifier\":\"F3DF0309-39AA-4C35-8141-89D354157F7B\"}, {\"inPlay\":{\"x\":0, \"y\":-1, \"z\":1}}, {\"class\":\"Hopper\", \"owner\":\"White\", \"identifier\":\"190C0B98-0554-48A3-B445-8F5F35E59CDA\"}, {\"inHand\":true}], \"stacks\":[{\"inPlay\":{\"x\":0, \"y\":0, \"z\":0}}, [{\"class\":\"Ant\", \"owner\":\"White\", \"identifier\":\"068429AB-BAB9-42C9-9ADC-A6195A72E356\"}], {\"inPlay\":{\"x\":0, \"y\":1, \"z\":-1}}, [{\"class\":\"Spider\", \"owner\":\"Black\", \"identifier\":\"4567454F-B069-4EF1-AA62-268D46EDC706\"}], {\"inPlay\":{\"x\":0, \"y\":-1, \"z\":1}}, [{\"class\":\"Queen\", \"owner\":\"White\", \"identifier\":\"F3DF0309-39AA-4C35-8141-89D354157F7B\"}], {\"inPlay\":{\"x\":-1, \"y\":0, \"z\":1}}, [{\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"2BE8249A-8D89-4FBA-8FDC-E7F3FF72EAAE\"}], {\"inPlay\":{\"x\":-1, \"y\":-1, \"z\":2}}, [{\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"13C4FD01-FD2B-4A4C-851F-9925EF7B469D\"}], {\"inPlay\":{\"x\":1, \"y\":-2, \"z\":1}}, [{\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"B969BE7A-9D22-4491-8E46-F09633D9E087\"}], {\"inPlay\":{\"x\":0, \"y\":2, \"z\":-2}}, [{\"class\":\"Queen\", \"owner\":\"Black\", \"identifier\":\"12B6024E-6937-47A1-99F7-6A69A8D9F3C4\"}]], \"move\":8, \"previousMoves\":[{\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":0, \"y\":0, \"z\":0}}, \"unit\":{\"class\":\"Ant\", \"owner\":\"White\", \"identifier\":\"068429AB-BAB9-42C9-9ADC-A6195A72E356\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"White\", \"move\":0}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":0, \"y\":1, \"z\":-1}}, \"unit\":{\"class\":\"Spider\", \"owner\":\"Black\", \"identifier\":\"4567454F-B069-4EF1-AA62-268D46EDC706\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"Black\", \"move\":1}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":0, \"y\":-1, \"z\":1}}, \"unit\":{\"class\":\"Queen\", \"owner\":\"White\", \"identifier\":\"F3DF0309-39AA-4C35-8141-89D354157F7B\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"White\", \"move\":2}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":0, \"y\":2, \"z\":-2}}, \"unit\":{\"class\":\"Queen\", \"owner\":\"Black\", \"identifier\":\"12B6024E-6937-47A1-99F7-6A69A8D9F3C4\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"Black\", \"move\":3}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":-1, \"y\":0, \"z\":1}}, \"unit\":{\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"2BE8249A-8D89-4FBA-8FDC-E7F3FF72EAAE\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"White\", \"move\":4}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":1, \"y\":1, \"z\":-2}}, \"unit\":{\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"B969BE7A-9D22-4491-8E46-F09633D9E087\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"Black\", \"move\":5}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":-1, \"y\":-1, \"z\":2}}, \"unit\":{\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"13C4FD01-FD2B-4A4C-851F-9925EF7B469D\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"White\", \"move\":6}, {\"movement\":{\"move\":{\"to\":{\"inPlay\":{\"x\":1, \"y\":-2, \"z\":1}}, \"unit\":{\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"B969BE7A-9D22-4491-8E46-F09633D9E087\"}}}, \"previousPosition\":{\"inPlay\":{\"x\":1, \"y\":1, \"z\":-2}}, \"player\":\"Black\", \"move\":7}], \"currentPlayer\":\"White\", \"hive_mind\":{\"units\":[{\"class\":\"Ant\", \"owner\":\"White\", \"identifier\":\"4D66AFC3-ADAE-4266-86E8-8E02C61D1169\"}, {\"inHand\":true}, {\"class\":\"Pill Bug\", \"owner\":\"Black\", \"identifier\":\"10341696-AA07-4EDB-B483-E5E78CD24488\"}, {\"inHand\":true}, {\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"F4457CE0-BB72-445D-8CC5-019E2FC4067D\"}, {\"inHand\":true}, {\"class\":\"Beetle\", \"owner\":\"Black\", \"identifier\":\"5D03EEFC-1173-4925-B7F7-B3A703C02A75\"}, {\"inHand\":true}, {\"class\":\"Hopper\", \"owner\":\"Black\", \"identifier\":\"CE761315-21A7-4912-BBDC-A542647888BE\"}, {\"inHand\":true}, {\"class\":\"Beetle\", \"owner\":\"Black\", \"identifier\":\"1C2FEADF-7875-4C33-8023-CAE04F94DA70\"}, {\"inHand\":true}, {\"class\":\"Spider\", \"owner\":\"Black\", \"identifier\":\"4567454F-B069-4EF1-AA62-268D46EDC706\"}, {\"inPlay\":{\"x\":0, \"y\":1, \"z\":-1}}, {\"class\":\"Mosquito\", \"owner\":\"Black\", \"identifier\":\"93DBF6D9-3C53-4A4C-9208-CF4A8102A34D\"}, {\"inHand\":true}, {\"class\":\"Hopper\", \"owner\":\"White\", \"identifier\":\"F97C07AF-633A-4B1E-A69B-C2B69867E0D5\"}, {\"inHand\":true}, {\"class\":\"Lady Bug\", \"owner\":\"Black\", \"identifier\":\"FDDDF012-9CD0-4D03-93E6-EF0FC37D1E76\"}, {\"inHand\":true}, {\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"13C4FD01-FD2B-4A4C-851F-9925EF7B469D\"}, {\"inPlay\":{\"x\":-1, \"y\":-1, \"z\":2}}, {\"class\":\"Spider\", \"owner\":\"Black\", \"identifier\":\"FC0FAA17-0D4D-4499-84F2-C7A4EFB8F012\"}, {\"inHand\":true}, {\"class\":\"Ant\", \"owner\":\"White\", \"identifier\":\"D8C45BE7-6518-4A6A-A7D2-39C316DF05FF\"}, {\"inHand\":true}, {\"class\":\"Lady Bug\", \"owner\":\"White\", \"identifier\":\"23707BC7-AA72-497E-B8B5-62BAB982F35C\"}, {\"inHand\":true}, {\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"8D710D17-570A-4AB8-A65F-4179A431C05A\"}, {\"inHand\":true}, {\"class\":\"Hopper\", \"owner\":\"Black\", \"identifier\":\"24958CFC-F0C9-4AEE-AF76-4F0D190D3738\"}, {\"inHand\":true}, {\"class\":\"Hopper\", \"owner\":\"Black\", \"identifier\":\"3962DCC3-431A-4BDF-8193-8AD7285C4E82\"}, {\"inHand\":true}, {\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"B969BE7A-9D22-4491-8E46-F09633D9E087\"}, {\"inPlay\":{\"x\":1, \"y\":-2, \"z\":1}}, {\"class\":\"Ant\", \"owner\":\"White\", \"identifier\":\"068429AB-BAB9-42C9-9ADC-A6195A72E356\"}, {\"inPlay\":{\"x\":0, \"y\":0, \"z\":0}}, {\"class\":\"Spider\", \"owner\":\"White\", \"identifier\":\"1AA3D8E9-70CA-487F-A18F-0D22F801CECA\"}, {\"inHand\":true}, {\"class\":\"Hopper\", \"owner\":\"White\", \"identifier\":\"3C82A1A8-1BA7-4C49-BBBB-3DA5B1B15945\"}, {\"inHand\":true}, {\"class\":\"Mosquito\", \"owner\":\"White\", \"identifier\":\"5D125385-4CF1-420D-B6BC-2DF60E7A1BAA\"}, {\"inHand\":true}, {\"class\":\"Pill Bug\", \"owner\":\"White\", \"identifier\":\"439C1ED9-736C-43C0-8F0B-8EDF1BB1B4B1\"}, {\"inHand\":true}, {\"class\":\"Spider\", \"owner\":\"White\", \"identifier\":\"87F0700D-E181-4D38-8C31-461BA3B12D1C\"}, {\"inHand\":true}, {\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"2BE8249A-8D89-4FBA-8FDC-E7F3FF72EAAE\"}, {\"inPlay\":{\"x\":-1, \"y\":0, \"z\":1}}, {\"class\":\"Queen\", \"owner\":\"Black\", \"identifier\":\"12B6024E-6937-47A1-99F7-6A69A8D9F3C4\"}, {\"inPlay\":{\"x\":0, \"y\":2, \"z\":-2}}, {\"class\":\"Queen\", \"owner\":\"White\", \"identifier\":\"F3DF0309-39AA-4C35-8141-89D354157F7B\"}, {\"inPlay\":{\"x\":0, \"y\":-1, \"z\":1}}, {\"class\":\"Hopper\", \"owner\":\"White\", \"identifier\":\"190C0B98-0554-48A3-B445-8F5F35E59CDA\"}, {\"inHand\":true}], \"stacks\":[{\"inPlay\":{\"x\":0, \"y\":0, \"z\":0}}, [{\"class\":\"Ant\", \"owner\":\"White\", \"identifier\":\"068429AB-BAB9-42C9-9ADC-A6195A72E356\"}], {\"inPlay\":{\"x\":0, \"y\":1, \"z\":-1}}, [{\"class\":\"Spider\", \"owner\":\"Black\", \"identifier\":\"4567454F-B069-4EF1-AA62-268D46EDC706\"}], {\"inPlay\":{\"x\":0, \"y\":-1, \"z\":1}}, [{\"class\":\"Queen\", \"owner\":\"White\", \"identifier\":\"F3DF0309-39AA-4C35-8141-89D354157F7B\"}], {\"inPlay\":{\"x\":-1, \"y\":0, \"z\":1}}, [{\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"2BE8249A-8D89-4FBA-8FDC-E7F3FF72EAAE\"}], {\"inPlay\":{\"x\":-1, \"y\":-1, \"z\":2}}, [{\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"13C4FD01-FD2B-4A4C-851F-9925EF7B469D\"}], {\"inPlay\":{\"x\":1, \"y\":-2, \"z\":1}}, [{\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"B969BE7A-9D22-4491-8E46-F09633D9E087\"}], {\"inPlay\":{\"x\":0, \"y\":2, \"z\":-2}}, [{\"class\":\"Queen\", \"owner\":\"Black\", \"identifier\":\"12B6024E-6937-47A1-99F7-6A69A8D9F3C4\"}]], \"move\":8, \"previousMoves\":[{\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":0, \"y\":0, \"z\":0}}, \"unit\":{\"class\":\"Ant\", \"owner\":\"White\", \"identifier\":\"068429AB-BAB9-42C9-9ADC-A6195A72E356\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"White\", \"move\":0}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":0, \"y\":1, \"z\":-1}}, \"unit\":{\"class\":\"Spider\", \"owner\":\"Black\", \"identifier\":\"4567454F-B069-4EF1-AA62-268D46EDC706\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"Black\", \"move\":1}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":0, \"y\":-1, \"z\":1}}, \"unit\":{\"class\":\"Queen\", \"owner\":\"White\", \"identifier\":\"F3DF0309-39AA-4C35-8141-89D354157F7B\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"White\", \"move\":2}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":0, \"y\":2, \"z\":-2}}, \"unit\":{\"class\":\"Queen\", \"owner\":\"Black\", \"identifier\":\"12B6024E-6937-47A1-99F7-6A69A8D9F3C4\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"Black\", \"move\":3}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":-1, \"y\":0, \"z\":1}}, \"unit\":{\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"2BE8249A-8D89-4FBA-8FDC-E7F3FF72EAAE\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"White\", \"move\":4}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":1, \"y\":1, \"z\":-2}}, \"unit\":{\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"B969BE7A-9D22-4491-8E46-F09633D9E087\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"Black\", \"move\":5}, {\"movement\":{\"place\":{\"to\":{\"inPlay\":{\"x\":-1, \"y\":-1, \"z\":2}}, \"unit\":{\"class\":\"Beetle\", \"owner\":\"White\", \"identifier\":\"13C4FD01-FD2B-4A4C-851F-9925EF7B469D\"}}}, \"previousPosition\":{\"inHand\":true}, \"player\":\"White\", \"move\":6}, {\"movement\":{\"move\":{\"to\":{\"inPlay\":{\"x\":1, \"y\":-2, \"z\":1}}, \"unit\":{\"class\":\"Ant\", \"owner\":\"Black\", \"identifier\":\"B969BE7A-9D22-4491-8E46-F09633D9E087\"}}}, \"previousPosition\":{\"inPlay\":{\"x\":1, \"y\":1, \"z\":-2}}, \"player\":\"Black\", \"move\":7}], \"currentPlayer\":\"White\"}}") {
				print(hivemind.play().json())
			}
		default:
			print("Invalid arguments.")
		}
	}
}
